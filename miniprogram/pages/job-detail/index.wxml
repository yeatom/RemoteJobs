<!--miniprogram/pages/job-detail/index.wxml-->
<view class="page">
  <ui-feedback id="ui-feedback" />
  <scroll-view     
    class="detail-content" 
    scroll-y="{{true}}"
    enhanced="true" 
    show-scrollbar="{{false}}"
    upper-threshold="0"
    bounces="{{false}}"
  >
    <block wx:if="{{job}}">
      <view class="detail-body">
        <view class="detail-header-section">
          <view class="detail-title-meta-wrapper">
        <view class="detail-title-row">
          <text class="detail-title">{{(isAIChinese && job.title_chinese) ? job.title_chinese : ((isAIEnglish && job.title_english) ? job.title_english : job.title)}}</text>
        </view>
        <view class="detail-meta" wx:if="{{(isAIEnglish && (job.source_name_english || job.source_name)) || (!isAIChinese && job.team && job.team !== ui.unknownCompany) || job.salary}}">
          <text wx:if="{{isAIEnglish && (job.source_name_english || job.source_name)}}" class="detail-meta-item">From {{job.source_name_english || job.source_name}}</text>
          <text wx:if="{{!isAIEnglish && job.team && job.team !== ui.unknownCompany}}" class="detail-meta-item">{{job.team}}</text>
          <text wx:if="{{((isAIEnglish && (job.source_name_english || job.source_name)) || (!isAIEnglish && job.team && job.team !== ui.unknownCompany)) && job.salary}}" class="detail-meta-dot">Â·</text>
          <text wx:if="{{job.salary}}" class="detail-meta-item">{{job.salary}}</text>
            </view>
          </view>
          <view class="collect-button" bindtap="toggleSave">
            <view class="collect-icon-wrapper">
              <image class="collect-icon" src="{{saved ? '/assets/icons/save-active-icon.png' : '/assets/icons/save-icon.png'}}" mode="aspectFit"></image>
            </view>
          </view>
        </view>
        <view class="detail-tags" wx:if="{{job.displayTags && job.displayTags.length > 0}}">
          <view class="detail-tag" wx:for="{{job.displayTags}}" wx:key="*this">
            <text class="detail-tag-text">{{item}}</text>
          </view>
        </view>
        <view class="detail-description-wrapper" wx:if="{{job.richDescription}}">
          <view class="detail-description">
          <rich-text class="detail-description-rich" nodes="{{job.richDescription}}"></rich-text>
        </view>
        </view>
      </view>
    </block>
    <block wx:elif="{{loading}}">
      <view class="loading">{{loadingText}}</view>
    </block>
    <block wx:else>
      <view class="error">{{loadFailedText}}</view>
    </block>
  </scroll-view>
  <!-- åº•éƒ¨æ“ä½œæ  (Dock) -->
  <view class="apply-overlay" wx:if="{{job}}">
    <view class="apply-overlay-mask"></view>
    <view class="apply-dock-content">
      <view class="apply-button" bindtap="onOneClickApply" hover-class="apply-button-active">
        <image class="apply-icon" src="/assets/icons/telegram.png" mode="aspectFit"></image>
        <text class="apply-text">{{oneClickApplyText}}</text>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½æŠ½å±‰ (Bottom Sheet) -->
  <block wx:if="{{showApplyMenu}}">
    <view class="bottom-sheet-mask {{applyMenuOpen ? 'bottom-sheet-mask-open' : ''}}" bindtap="closeApplyMenu"></view>
    <view class="bottom-sheet {{applyMenuOpen ? 'bottom-sheet-open' : ''}}">
      
      <view class="bottom-sheet-header">
        <view class="bottom-sheet-header-left"></view>
        <text class="bottom-sheet-title">{{applyMenuTitle}}</text>
        <view class="bottom-sheet-header-right">
          <view class="bottom-sheet-header-btn" bindtap="closeApplyMenu">{{ui.cancel}}</view>
        </view>
      </view>
      
      <scroll-view class="apply-menu-scroll" scroll-y enhanced="true" show-scrollbar="{{false}}">
        <view class="apply-menu-content-padding">
          <!-- AI å¢žå¼ºåŠŸèƒ½åŒº -->
          <view class="apply-menu-section ai-section">
            <view class="apply-menu-item ai-item" bindtap="onGenerateResume">
              <view class="apply-menu-item-left">
                <image class="apply-menu-item-icon ai-icon" src="/assets/icons/four-point-star-twin.png" mode="aspectFit"></image>
                <text class="apply-menu-item-text ai-text">{{aiResumeGenerateText}}</text>
              </view>
            </view>
          </view>

          <!-- å¸¸è§„åŠŸèƒ½åŒº -->
          <view class="apply-menu-section">
            <view class="apply-menu-item" bindtap="onViewSource">
              <view class="apply-menu-item-left">
                <view class="apply-menu-icon-placeholder">ðŸ”—</view>
                <text class="apply-menu-item-text">{{copySourceLinkText}}</text>
              </view>
            </view>
          </view>
        </view>
      </scroll-view>

      <!-- åº•éƒ¨å®‰å…¨é—´è· -->
      <view class="apply-menu-safe-bottom"></view>
    </view>
  </block>
</view>

