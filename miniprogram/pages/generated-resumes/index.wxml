<view class="page-container">
  <ui-feedback id="ui-feedback" />
  <view class="header-section" wx:if="{{resumes.length > 0}}">
    <text class="count-text">{{ui.totalPrefix}}{{resumes.length}} {{ui.assetCount}}</text>
    <view class="edit-btn" bindtap="onToggleEdit">{{isEditMode ? ui.done : ui.edit}}</view>
  </view>

  <view class="list-section">
    <block wx:if="{{loading && resumes.length === 0}}">
      <view class="loading-state">
        <view class="ui-spinner"></view>
        <text>{{ui.syncingAssets}}</text>
      </view>
    </block>

    <block wx:elif="{{resumes.length > 0}}">
      <view class="resume-card {{item.status === 'processing' ? 'card-processing' : ''}} {{item.status === 'failed' ? 'card-failed' : ''}}" 
            wx:for="{{resumes}}" wx:key="_id" 
            bindtap="onPreviewResume" data-item="{{item}}" 
            hover-class="{{item.status === 'completed' ? 'card-hover' : ''}}">
        <view class="card-left">
          <view class="pdf-icon-box {{item.status === 'processing' ? 'pdf-icon-processing' : ''}} {{item.status === 'failed' ? 'pdf-icon-failed' : ''}}">
            <text class="pdf-text">{{item.status === 'failed' ? 'ERR' : 'PDF'}}</text>
            <view class="pdf-decoration" wx:if="{{item.status !== 'failed'}}"></view>
          </view>
        </view>
        
        <view class="card-body">
          <view class="title-row">
            <text class="job-title">{{((currentLang === 'English' || currentLang === 'AIEnglish') ? item.jobTitle_en : item.jobTitle_cn) || item.jobTitle}}</text>
            <view wx:if="{{item.status === 'failed'}}" class="failed-tag">{{ui.statusFailed}}</view>
          </view>
          <text class="company-name">{{item.company || ui.generalResume}}</text>
          <text class="date-text">{{item.formattedDate}}</text>
        </view>

        <view class="card-right">
          <block wx:if="{{isEditMode}}">
             <view class="delete-btn" catchtap="onDeleteResume" data-item="{{item}}">{{ui.delete}}</view>
          </block>
          <block wx:else>
            <block wx:if="{{item.status === 'processing'}}">
              <view class="ui-spinner" style="width: 32rpx; height: 32rpx; border-width: 3rpx;"></view>
            </block>
            <block wx:elif="{{item.status === 'failed'}}">
              <view class="retry-btn" catchtap="onRetryResume" data-item="{{item}}">{{ui.retry}}</view>
            </block>
            <block wx:else>
              <view class="view-btn">{{ui.view}}</view>
            </block>
          </block>
        </view>
      </view>
    </block>

    <block wx:else>
      <view class="empty-state">
        <view class="empty-icon">ðŸ“„</view>
        <text class="empty-title">{{ui.emptyTitle}}</text>
        <text class="empty-subtitle">{{ui.emptySubtitle}}</text>
        <button class="go-jobs-btn" bindtap="goJobsList">{{ui.goJobs}}</button>
      </view>
    </block>
  </view>

  <view class="bottom-safe-area"></view>
</view>

