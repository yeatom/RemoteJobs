<!-- 个人资料底部弹窗 -->
<block wx:if="{{showProfileSheet}}">
  <view class="bottom-sheet-mask {{profileSheetOpen ? 'bottom-sheet-mask-open' : ''}}"
        bindtap="closeProfileSheet"></view>
  <view class="bottom-sheet {{profileSheetOpen ? 'bottom-sheet-open' : ''}}">
    <view class="bottom-sheet-header">
      <text class="profile-sheet-title">用户资料</text>
    </view>

    <view class="bottom-sheet-content profile-sheet-content">
      <!-- Upload Avatar - 独立一栏，左右布局 -->
      <view class="profile-avatar-section" catchtap="onUploadAvatar">
        <text class="profile-avatar-title">{{ui.uploadAvatar}}</text>
        <view class="profile-avatar-content">
          <block wx:if="{{userInfo}}">
            <view class="profile-avatar-wrapper profile-avatar-bordered">
              <image class="profile-avatar-preview" src="{{userInfo.avatarUrl}}" mode="aspectFill"/>
            </view>
          </block>
          <block wx:else>
            <view class="profile-avatar-wrapper profile-avatar-bordered">
              <view class="profile-avatar-placeholder"></view>
            </view>
          </block>
        </view>
      </view>

      <!-- Edit Nickname & Phone Number - 合并到一个card -->
      <view class="profile-info-section">
        <!-- Edit Nickname -->
        <view class="profile-info-item">
          <view class="profile-nickname-header">
            <text class="profile-nickname-title">{{ui.editNickname}}</text>
            <view class="profile-nickname-change-btn" catchtap="onEditNickname">
              <text class="profile-nickname-change-btn-text">{{ui.changePhone}}</text>
            </view>
          </view>
          <view class="profile-nickname-content">
            <text class="profile-nickname-value">{{userInfo ? userInfo.nickName : '未设置'}}</text>
          </view>
        </view>

        <!-- Phone Number -->
        <view class="profile-info-item">
          <view class="profile-phone-header">
            <text class="profile-phone-title">{{ui.phoneNumber}}</text>
            <button
                    class="profile-phone-change-btn"
                    open-type="getPhoneNumber"
                    bindgetphonenumber="onChangePhoneNumber"
            >
              <text class="profile-phone-change-btn-text">{{ui.changePhone}}</text>
            </button>
          </view>
          <view class="profile-phone-content">
            <text class="profile-phone-value">{{maskedPhone}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</block>

<!-- Edit Nickname Modal -->
<block wx:if="{{showNicknameModal}}">
  <view class="nickname-modal-mask {{nicknameModalOpen ? 'nickname-modal-mask-open' : ''}}" catchtap="closeNicknameModal"></view>
  <view class="nickname-modal {{nicknameModalOpen ? 'nickname-modal-open' : ''}}">
    <view class="nickname-modal-header">
      <text class="nickname-modal-title">{{ui.editNickname}}</text>
    </view>
    <view class="nickname-modal-body">
      <input
              class="nickname-modal-input"
              type="text"
              value="{{newNickname}}"
              bindinput="onNicknameInput"
              maxlength="20"
              placeholder="{{ui.editNickname}}"
              focus="{{nicknameModalOpen}}"
              confirm-type="done"
              bindconfirm="onSaveNickname"
      />
    </view>
    <view class="nickname-modal-footer">
      <view class="nickname-modal-btn nickname-modal-cancel" catchtap="onCancelEditNickname">
        <text class="nickname-modal-btn-text">{{ui.cancel}}</text>
      </view>
      <view class="nickname-modal-btn nickname-modal-save" catchtap="onSaveNickname">
        <text class="nickname-modal-btn-text">{{ui.save}}</text>
      </view>
    </view>
  </view>
</block>
