<view class="page">
  <view class="me-card" bindtap="onAvatarTap">
    <view class="user-row">
      <block wx:if="{{userInfo}}">
        <image class="avatar" src="{{userInfo.avatarUrl}}" />
      </block>
      <block wx:else>
        <view class="avatar-placeholder"></view>
      </block>

      <view class="user-text">
        <block wx:if="{{!isLoggedIn}}">
          <button
            class="phone-auth-name-btn"
            open-type="getPhoneNumber"
            bindgetrealtimephonenumber="onGetRealtimePhoneNumber"
            bindgetphonenumber="onGetPhoneNumber"
          >
            <text class="nickname nickname-login">{{ui.userNotLoggedIn}}</text>
          </button>
        </block>
        <block wx:else>
          <view class="nickname-container">
          <text class="nickname">{{userInfo ? userInfo.nickName : 'Â∑≤ÁôªÂΩï'}}</text>
            <view wx:if="{{isMember}}" class="member-badge">
              <text class="member-text">{{ui.memberBadge}}</text>
            </view>
          </view>
        </block>
      </view>
    </view>
  </view>

  <view class="me-list">
    <view class="me-item" bindtap="onLanguageTap">
      <text class="me-item-text">{{ui.aiTranslateEntry}}</text>
    </view>

    <view class="me-item">
      <text class="me-item-text">{{ui.generateResumeEntry}}</text>
    </view>

    <view class="me-item">
      <text class="me-item-text">{{ui.publishSkillEntry}}</text>
    </view>

    <view class="me-item" bindtap="onInviteTap">
      <text class="me-item-text">{{ui.inviteCodeEntry}}</text>
    </view>
  </view>

  <!-- Language bottom sheet (same animation as saved sheet) -->
  <block wx:if="{{showLanguageSheet}}">
    <view class="language-sheet-mask {{languageSheetOpen ? 'language-sheet-mask-open' : ''}}" bindtap="closeLanguageSheet"></view>
    <view class="language-sheet {{languageSheetOpen ? 'language-sheet-open' : ''}}">

      <view class="language-sheet-content">
        <view class="language-item {{currentLanguage === 'Chinese' ? 'language-item-active' : ''}}" data-value="Chinese" bindtap="onLanguageSelect">
          <text class="language-item-text">{{ui.langDefault}}</text>
        </view>
        <view class="language-item {{currentLanguage === 'English' ? 'language-item-active' : ''}}" data-value="English" bindtap="onLanguageSelect">
          <text class="language-item-text">{{ui.langEnglish}}</text>
        </view>
        <view class="language-item {{currentLanguage === 'AIChinese' ? 'language-item-active' : ''}}" data-value="AIChinese" bindtap="onLanguageSelect">
          <view class="language-item-text">
            <text>{{ui.langAIChinese}}</text>
            <image class="member-star-icon" src="/assets/icons/four-point-star-twin.png" mode="aspectFit" />
            <text wx:if="{{!isAiChineseUnlocked}}"> üîí</text>
          </view>
        </view>
        <view class="language-item {{currentLanguage === 'AIEnglish' ? 'language-item-active' : ''}}" data-value="AIEnglish" bindtap="onLanguageSelect">
          <view class="language-item-text">
            <text>{{ui.langAIEnglish}}</text>
            <image class="member-star-icon" src="/assets/icons/four-point-star-twin.png" mode="aspectFit" />
            <text wx:if="{{!isAiChineseUnlocked}}"> üîí</text>
          </view>
        </view>
      </view>
    </view>
  </block>

  <!-- Invite code bottom sheet -->
  <block wx:if="{{showInviteSheet}}">
    <view class="invite-sheet-mask {{inviteSheetOpen ? 'invite-sheet-mask-open' : ''}}" bindtap="closeInviteSheet"></view>
    <view class="invite-sheet {{inviteSheetOpen ? 'invite-sheet-open' : ''}}">

      <view class="invite-sheet-content">
        <view class="invite-section">
          <text class="invite-section-title">{{ui.myInviteCode}}</text>
          <view class="invite-code-display" bindtap="onCopyInviteCode">
            <text class="invite-code-text">{{myInviteCode}}</text>
            <text class="invite-code-copy">Â§çÂà∂</text>
          </view>
        </view>

        <view class="invite-section">
          <text class="invite-section-title">{{ui.inputInviteCode}}</text>
          <input
            class="invite-code-input"
            type="text"
            placeholder="ËØ∑ËæìÂÖ•ÈÇÄËØ∑Á†Å"
            value="{{inputInviteCode}}"
            bindinput="onInviteCodeInput"
          />
          <button class="invite-apply-btn" bindtap="onApplyInviteCode">Â∫îÁî®</button>
        </view>
      </view>
    </view>
  </block>

  <!-- User Profile Sheet (from bottom, same as restore-sheet) -->
  <block wx:if="{{showProfileSheet}}">
    <view class="bottom-sheet-mask {{profileSheetOpen ? 'bottom-sheet-mask-open' : ''}}" bindtap="closeProfileSheet"></view>
    <view class="bottom-sheet profile-sheet {{profileSheetOpen ? 'bottom-sheet-open' : ''}}">
      <view class="bottom-sheet-header profile-sheet-header">
        <text class="profile-sheet-title">Áî®Êà∑ËµÑÊñô</text>
      </view>
      
      <view class="bottom-sheet-content profile-sheet-content">
        <!-- Upload Avatar -->
        <view class="profile-item" catchtap="onUploadAvatar">
          <view class="profile-item-left">
            <text class="profile-item-label">{{ui.uploadAvatar}}</text>
          </view>
          <view class="profile-item-right">
            <block wx:if="{{userInfo}}">
              <image class="profile-avatar-preview" src="{{userInfo.avatarUrl}}" mode="aspectFill" />
            </block>
            <block wx:else>
              <view class="profile-avatar-placeholder"></view>
            </block>
          </view>
        </view>

        <!-- Edit Nickname -->
        <view class="profile-item">
          <view class="profile-item-left">
            <text class="profile-item-label">{{ui.editNickname}}</text>
          </view>
          <view class="profile-item-right">
            <block wx:if="{{editingNickname}}">
              <input 
                class="profile-nickname-input" 
                type="text" 
                value="{{newNickname}}" 
                bindinput="onNicknameInput"
                maxlength="20"
                placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑Âêç"
                focus="{{editingNickname}}"
              />
              <view class="profile-edit-actions">
                <text class="profile-edit-btn profile-edit-cancel" catchtap="onCancelEditNickname">ÂèñÊ∂à</text>
                <text class="profile-edit-btn profile-edit-save" catchtap="onSaveNickname">‰øùÂ≠ò</text>
              </view>
            </block>
            <block wx:else>
              <text class="profile-item-value">{{userInfo ? userInfo.nickName : 'Êú™ËÆæÁΩÆ'}}</text>
              <text class="profile-edit-icon" catchtap="onEditNickname">ÁºñËæë</text>
            </block>
          </view>
        </view>

        <!-- Member Expired Date -->
        <view class="profile-item" catchtap="onRenewMember">
          <view class="profile-item-left">
            <text class="profile-item-label">{{ui.memberExpiredDate}}</text>
          </view>
          <view class="profile-item-right profile-item-right-center">
            <view class="profile-item-value {{isMember ? 'profile-member-active' : 'profile-member-expired'}}">
              {{expiredDateText}}
            </view>
          </view>
        </view>
      </view>
    </view>
  </block>
</view>
