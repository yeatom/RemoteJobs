<view class="page">
  <ui-feedback id="ui-feedback" />

  <view wx:if="{{isInitialLoading}}" class="loading-box">
    <view class="loading-spinner"></view>
    <text>{{ui.loading}}</text>
  </view>

  <block wx:else>
    <!-- 1. Ê≤âÊµ∏ÂºèÂ§¥ÈÉ® Hero Section -->
    <view class="hero-section">
      <view class="hero-bg"></view>
      <view class="user-container" bindtap="onAvatarTap">
        <view class="avatar-wrapper member-color-{{memberLevel}}">
          <block wx:if="{{userInfo}}">
            <image class="avatar-large" src="{{userInfo.avatarUrl}}" />
          </block>
          <block wx:else>
            <view class="avatar-placeholder-large"></view>
          </block>
          <view class="edit-badge">
            <view class="edit-badge-icon"></view>
          </view>
        </view>
        <view class="user-info-main">
          <text class="nickname-large">{{userInfo.nickName || ui.loginNow}}</text>
          <view class="user-subtext-wrapper">
            <text class="user-subtext">{{ui.viewEditProfile}}</text>
            <text class="row-arrow">‚ùØ</text>
          </view>
        </view>
      </view>
    </view>

    <view class="content-body">
    <!-- 2. ‰ºöÂëòÊùÉÁõäÁúãÊùø VIP Benefit Card -->
    <view class="vip-benefit-card vip-level-{{memberLevel}} {{isMember ? 'vip-active' : ''}}" bindtap="onVipCardTap">
      <view class="vip-main-content">
        <!-- Â§¥ÈÉ®ÔºöÁ≠âÁ∫ß‰∏éÊúâÊïàÊúü -->
        <view class="vip-card-header">
          <view class="vip-title-row">
            <text class="vip-identity-title">{{isMember ? memberBadgeText : ui.regularUser}}</text>
            <view wx:if="{{isMember}}" class="vip-badge-icon badge-level-{{memberLevel}}"></view>
          </view>
          <text class="vip-expiry-date" wx:if="{{isMember}}">{{memberExpiryText}}</text>
        </view>

        <!-- ‰∏≠ÈÉ®ÔºöÊùÉÁõäÊèèËø∞ÊàñÈÖçÈ¢ùËøõÂ∫¶ -->
        <view class="vip-card-body">
          <block wx:if="{{memberLevel === 1}}">
            <view class="quota-container">
              <view class="quota-label-row">
                <text class="quota-label">{{ui.jobQuota}}</text>
                <text class="quota-value">{{jobQuotaUsed}}/{{jobQuotaLimit}}</text>
              </view>
              <view class="quota-progress-bar">
                <view class="quota-progress-inner {{isQuotaExhausted ? 'quota-full' : ''}}" style="width: {{jobQuotaProgress}}%"></view>
              </view>
            </view>
          </block>
          <block wx:else>
            <text class="vip-desc">{{isMember ? ui.memberFullAccess : ui.unlockAIFeatures}}</text>
          </block>
        </view>

        <!-- Â∫ïÈÉ®ÔºöÊìç‰ΩúÊåâÈíÆ‰∏éÂçáËà±ÂºïÂØº -->
        <view class="vip-card-footer">
          <block wx:if="{{memberLevel === 1 && isQuotaExhausted}}">
            <view class="upgrade-guide-box" catchtap="onUpgrade">
              <text class="upgrade-text">{{ui.upgradeGuide}}</text>
            </view>
          </block>
          <view wx:else></view> <!-- Âç†‰Ωç‰øùÊåÅ space-between -->
          <view class="vip-btn btn-level-{{memberLevel}}">{{isMember ? ui.manageBenefits : ui.unlockNow}}</view>
        </view>
      </view>

      <view class="vip-card-bg-icon member-color-{{memberLevel}}"></view>
      <view wx:if="{{memberLevel === 3}}" class="shimmer-effect"></view>
    </view>

    <!-- 3. Ê†∏ÂøÉÂäüËÉΩÂàóË°® Action List Group -->
    <view class="action-list-group">
      <view class="action-row" bindtap="onResumeProfileTap" hover-class="row-hover">
        <view class="row-left">
          <view class="icon-circle blue-bg">üìÑ</view>
          <view class="row-text">
            <text class="row-title">{{ui.resumeProfileEntry}}</text>
            <text class="row-subtitle">{{ui.resumeProfileSubtitle}}</text>
          </view>
        </view>
        <view class="row-right">
          <text class="row-arrow">‚ùØ</text>
        </view>
      </view>

      <view class="action-row" bindtap="onGeneratedResumesTap" hover-class="row-hover">
        <view class="row-left">
          <view class="icon-circle green-bg">‚ú®</view>
          <view class="row-text">
            <text class="row-title">{{ui.generatedResumesEntry}}</text>
            <text class="row-subtitle">{{ui.generatedResumesSubtitle}}</text>
          </view>
        </view>
        <view class="row-right">
          <text class="row-arrow">‚ùØ</text>
        </view>
      </view>
    </view>

    <!-- 4. ËÆæÁΩÆÂàóË°® Settings List -->
    <view class="settings-group">
      <view class="setting-row" bindtap="onLanguageTap" hover-class="row-hover">
        <view class="row-left">
          <view class="row-icon-box"><text>üåç</text></view>
          <text class="row-label">{{ui.languageEntry}}</text>
        </view>
        <view class="row-right">
          <text class="row-value">{{appLanguage === 'Chinese' ? ui.langChinese : (appLanguage === 'AIChinese' ? ui.langAIChinese : (appLanguage === 'English' ? ui.langEnglish : ui.langAIEnglish))}}</text>
          <text class="row-arrow">‚ùØ</text>
        </view>
      </view>

      <view class="setting-row" bindtap="onInviteTap" hover-class="row-hover" wx:if="{{isBeta}}">
        <view class="row-left">
          <view class="row-icon-box"><text>‚úâÔ∏è</text></view>
          <text class="row-label">{{ui.inviteCodeEntry}}</text>
        </view>
        <view class="row-right">
          <text class="row-arrow">‚ùØ</text>
        </view>
      </view>

      <view class="setting-row" bindtap="onContactAuthor" hover-class="row-hover">
        <view class="row-left">
          <view class="row-icon-box"><text style="font-size: 28rpx;">üí¨</text></view>
          <text class="row-label">{{ui.contactAuthor}}</text>
        </view>
        <view class="row-right">
          <text class="row-arrow">‚ùØ</text>
        </view>
      </view>
    </view>

  </view>

  <!-- Bottom Sheets & Modals (Rest of the original code) -->
  <block wx:if="{{showLanguageSheet}}">
    <view class="bottom-sheet-mask {{languageSheetOpen ? 'bottom-sheet-mask-open' : ''}}"
          bindtap="closeLanguageSheet"></view>
    <view class="bottom-sheet {{languageSheetOpen ? 'bottom-sheet-open' : ''}}">
      <view class="bottom-sheet-header">
        <view class="bottom-sheet-header-left"></view>
        <text class="bottom-sheet-title">{{ui.languageEntry}}</text>
        <view class="bottom-sheet-header-right">
          <view class="bottom-sheet-header-btn" bindtap="closeLanguageSheet">{{ui.confirm}}</view>
        </view>
      </view>
      <view class="bottom-sheet-content">
        <!-- Standard Modes -->
        <view class="mode-section-title">{{ui.basicMode}}</view>
        <view class="mode-card {{appLanguage === 'Chinese' ? 'mode-card-active' : ''}}"
              data-value="Chinese" bindtap="onLanguageSelect">
          <view class="mode-card-main">
            <text class="mode-name">{{ui.langChinese}}</text>
            <text class="mode-desc">{{ui.langChineseDesc}}</text>
          </view>
          <view class="mode-check" wx:if="{{appLanguage === 'Chinese'}}">
            <icon type="success_no_circle" size="16" color="#1d4ed8"/>
          </view>
        </view>

        <view class="mode-card {{appLanguage === 'English' ? 'mode-card-active' : ''}}"
              data-value="English" bindtap="onLanguageSelect">
          <view class="mode-card-main">
            <text class="mode-name">{{ui.langEnglish}}</text>
            <text class="mode-desc">{{ui.langEnglishDesc}}</text>
          </view>
          <view class="mode-check" wx:if="{{appLanguage === 'English'}}">
            <icon type="success_no_circle" size="16" color="#1d4ed8"/>
          </view>
        </view>

        <!-- AI VIP Modes -->
        <view class="mode-section-title mode-section-title-vip">
          <text>{{ui.aiMode}}</text>
          <text class="vip-tag-mini">{{ui.vipTag}}</text>
        </view>

        <view class="mode-card mode-card-vip {{appLanguage === 'AIChinese' ? 'mode-card-active' : ''}}"
              data-value="AIChinese" bindtap="onLanguageSelect">
          <view class="mode-card-icon">‚ú®</view>
          <view class="mode-card-main">
            <text class="mode-name">{{ui.langAIChinese}}</text>
            <text class="mode-desc">{{ui.langAIChineseDesc}}</text>
          </view>
          <view class="mode-check" wx:if="{{appLanguage === 'AIChinese'}}">
            <icon type="success_no_circle" size="16" color="#1d4ed8"/>
          </view>
        </view>

        <view class="mode-card mode-card-vip {{appLanguage === 'AIEnglish' ? 'mode-card-active' : ''}}"
              data-value="AIEnglish" bindtap="onLanguageSelect">
          <view class="mode-card-icon">‚ú®</view>
          <view class="mode-card-main">
            <text class="mode-name">{{ui.langAIEnglish}}</text>
            <text class="mode-desc">{{ui.langAIEnglishDesc}}</text>
          </view>
          <view class="mode-check" wx:if="{{appLanguage === 'AIEnglish'}}">
            <icon type="success_no_circle" size="16" color="#1d4ed8"/>
          </view>
        </view>
      </view>
    </view>
  </block>

  <block wx:if="{{showInviteSheet}}">
    <view class="bottom-sheet-mask {{inviteSheetOpen ? 'bottom-sheet-mask-open' : ''}}"
          bindtap="closeInviteSheet"></view>
    <view class="bottom-sheet {{inviteSheetOpen ? 'bottom-sheet-open' : ''}}">
      <view class="bottom-sheet-header">
        <view class="bottom-sheet-header-left"></view>
        <text class="bottom-sheet-title">{{ui.inviteCodeEntry}}</text>
        <view class="bottom-sheet-header-right">
          <view class="bottom-sheet-header-btn" bindtap="closeInviteSheet">{{ui.confirm}}</view>
        </view>
      </view>
      <view class="bottom-sheet-content invite-sheet-content">
        <!-- Referral Card -->
        <view class="invite-card referral-card">
          <view class="invite-card-info">
            <text class="invite-card-label">{{ui.myInviteCode}}</text>
            <text class="invite-card-tips">{{ui.shareDesc}}</text>
          </view>
          <view class="invite-code-wrapper" bindtap="onCopyInviteCode">
            <text class="invite-code-value">{{myInviteCode}}</text>
            <view class="copy-pill">{{ui.copy}}</view>
          </view>
        </view>

        <!-- Redemption Section -->
        <view class="invite-input-section">
          <input class="invite-modern-input" type="text" placeholder="{{ui.inputInviteCodePlaceholder}}" 
                 value="{{inputInviteCode}}" bindinput="onInviteCodeInput" />
          <button class="invite-modern-btn" bindtap="onApplyInviteCode">{{ui.apply}}</button>
        </view>
      </view>
    </view>
  </block>

  <include src="./profile-sheet.wxml"/>

  <!-- ‰ºöÂëòÊùÉÁõä center ÂºπÁ™ó Member Hub Sheet -->
  <block wx:if="{{showMemberHub}}">
    <view class="bottom-sheet-mask {{memberHubOpen ? 'bottom-sheet-mask-open' : ''}}" bindtap="closeMemberHub"></view>
    <view class="bottom-sheet {{memberHubOpen ? 'bottom-sheet-open' : ''}}">
      <view class="bottom-sheet-header">
        <view class="bottom-sheet-header-left"></view>
        <text class="bottom-sheet-title">{{ui.manageBenefits}}</text>
        <view class="bottom-sheet-header-right">
          <view class="bottom-sheet-header-btn" bindtap="closeMemberHub">{{ui.confirm}}</view>
        </view>
      </view>
      <view class="bottom-sheet-content member-hub-content">
        
        <!-- 1. Header: Status & Expiry -->
        <view class="hub-header">
          <view class="hub-user-info">
            <view class="vip-badge-icon badge-level-{{memberLevel}}"></view>
            <text class="hub-level-name">{{memberBadgeText || ui.regularUser}}</text>
          </view>
          <text class="hub-expiry-date" wx:if="{{isMember}}">{{expiredDateText}}{{ui.expiresSuffix}}</text>
        </view>

        <!-- 2. Quota Dashboard -->
        <view class="hub-quota-card">
          <view class="quota-title-row">
            <text class="quota-title">{{ui.aiQuotaTitle}}</text>
            <text class="quota-infinite-tag" wx:if="{{memberLevel === 3}}">{{ui.unlimited}}</text>
          </view>
          
          <block wx:if="{{memberLevel === 3}}">
            <view class="quota-infinite-box">
              <text class="quota-infinite-text">{{ui.unlimitedUse}}</text>
              <view class="infinite-sparkle">‚ú®</view>
            </view>
          </block>
          <block wx:else>
            <view class="hub-progress-section">
              <view class="hub-progress-bar">
                <view class="hub-progress-inner {{isQuotaExhausted ? 'quota-full' : ''}}" style="width: {{jobQuotaProgress}}%"></view>
              </view>
              <view class="hub-quota-labels">
                <text class="hub-quota-used">{{ui.quotaUsed}} {{jobQuotaUsed}}</text>
                <text class="hub-quota-limit">{{ui.totalQuota}} {{jobQuotaLimit}}</text>
              </view>
            </view>
          </block>
        </view>

        <!-- 3. Privileges List -->
        <view class="hub-benefit-list">
          <view class="hub-benefit-item {{memberLevel >= 1 ? 'benefit-active' : ''}}">
            <icon type="{{memberLevel >= 1 ? 'success' : 'waiting'}}" size="16" color="{{memberLevel >= 1 ? '#2e5fe9' : '#cbd5e1'}}" />
            <view class="benefit-info">
              <text class="benefit-name">{{ui.benefitTranslateTitle}}</text>
              <text class="benefit-sub">{{ui.benefitTranslateSub}}</text>
            </view>
          </view>
          <view class="hub-benefit-item {{memberLevel >= 2 ? 'benefit-active' : ''}}">
            <icon type="{{memberLevel >= 2 ? 'success' : 'waiting'}}" size="16" color="{{memberLevel >= 2 ? '#2e5fe9' : '#cbd5e1'}}" />
            <view class="benefit-info">
              <text class="benefit-name">{{ui.benefitResumeTitle}}</text>
              <text class="benefit-sub">{{ui.benefitResumeSub}}</text>
            </view>
          </view>
          <view class="hub-benefit-item {{memberLevel >= 3 ? 'benefit-active' : ''}}">
            <icon type="{{memberLevel >= 3 ? 'success' : 'waiting'}}" size="16" color="{{memberLevel >= 3 ? '#2e5fe9' : '#cbd5e1'}}" />
            <view class="benefit-info">
              <text class="benefit-name">{{ui.benefitApplyTitle}}</text>
              <text class="benefit-sub">{{ui.benefitApplySub}}</text>
            </view>
          </view>
        </view>

        <!-- 4. Action Bar -->
        <view class="hub-action-bar">
          <view class="hub-action-left {{memberLevel === 3 ? 'full-width' : ''}}" bindtap="onRenew">
            <text class="action-btn-text secondary">{{ui.renewNow}}</text>
          </view>
          <view class="hub-action-right" wx:if="{{memberLevel < 3}}" bindtap="onUpgrade">
            <text class="action-btn-text primary">{{ui.upgradeAmountText}} ¬•{{upgradeAmount}}</text>
          </view>
        </view>

      </view>
    </view>
  </block>

  <!-- ËÅîÁ≥ª‰ΩúËÄÖÂºπÁ™ó Contact Author Sheet -->
  <block wx:if="{{showContactSheet}}">
    <view class="bottom-sheet-mask {{contactSheetOpen ? 'bottom-sheet-mask-open' : ''}}"
          bindtap="closeContactSheet"></view>
    <view class="bottom-sheet {{contactSheetOpen ? 'bottom-sheet-open' : ''}}">
      <view class="bottom-sheet-header">
        <view class="bottom-sheet-header-left"></view>
        <text class="bottom-sheet-title">{{ui.contactAuthor}}</text>
        <view class="bottom-sheet-header-right">
          <view class="bottom-sheet-header-btn" bindtap="closeContactSheet">{{ui.confirm}}</view>
        </view>
      </view>
      <view class="bottom-sheet-content author-sheet-content">
        <view class="author-sheet-body">
          <text class="author-slogan">{{ui.authorWechatSlogan}}</text>
          <view class="qr-code-container-sheet">
            <image class="qr-code-image-sheet" src="cloud://{{cloudUrlPrefix}}/contact-info.JPG" mode="widthFix" show-menu-by-longpress="{{true}}" />
          </view>
          <text class="qr-hint">{{ui.qrHint}}</text>
        </view>
      </view>
    </view>
  </block>
  </block>
</view>
