<view class="page">
  <!-- 1. æ²‰æµ¸å¼å¤´éƒ¨ Hero Section -->
  <view class="hero-section">
    <view class="hero-bg"></view>
    <view class="user-container" bindtap="onAvatarTap">
      <view class="avatar-wrapper">
        <block wx:if="{{userInfo}}">
          <image class="avatar-large {{memberLevel === 3 ? 'avatar-premium' : ''}}" src="{{userInfo.avatarUrl}}" />
        </block>
        <block wx:else>
          <view class="avatar-placeholder-large"></view>
        </block>
        <view class="edit-badge">
          <icon type="info" size="12" color="#fff"/>
        </view>
      </view>
      <view class="user-info-main">
        <block wx:if="{{isInitialLoading}}">
          <text class="nickname-large">åŠ è½½ä¸­...</text>
        </block>
        <block i:else>
          <text class="nickname-large">{{userInfo.nickName || 'ç«‹å³ç™»å½•'}}</text>
          <view class="user-subtext-wrapper">
            <text class="user-subtext">æŸ¥çœ‹å¹¶ç¼–è¾‘ä¸ªäººèµ„æ–™</text>
            <text class="row-arrow">â¯</text>
          </view>
        </block>
      </view>
    </view>
  </view>

  <view class="content-body">
    <!-- 2. ä¼šå‘˜æƒç›Šçœ‹æ¿ VIP Benefit Card -->
    <view class="vip-benefit-card vip-level-{{memberLevel}} {{isMember ? 'vip-active' : ''}}" bindtap="onVipCardTap">
      <view class="vip-main-content">
        <!-- å¤´éƒ¨ï¼šç­‰çº§ä¸æœ‰æ•ˆæœŸ -->
        <view class="vip-card-header">
          <view class="vip-title-row">
            <text class="vip-identity-title">{{isMember ? memberBadgeText : 'æ™®é€šç”¨æˆ·'}}</text>
            <view wx:if="{{isMember}}" class="vip-badge-icon badge-level-{{memberLevel}}"></view>
          </view>
          <text class="vip-expiry-date" wx:if="{{isMember}}">{{memberExpiryText}}</text>
        </view>

        <!-- ä¸­éƒ¨ï¼šæƒç›Šæè¿°æˆ–é…é¢è¿›åº¦ -->
        <view class="vip-card-body">
          <block wx:if="{{memberLevel === 1}}">
            <view class="quota-container">
              <view class="quota-label-row">
                <text class="quota-label">å²—ä½æç‚¼é…é¢</text>
                <text class="quota-value">{{jobQuotaUsed}}/{{jobQuotaLimit}}</text>
              </view>
              <view class="quota-progress-bar">
                <view class="quota-progress-inner {{isQuotaExhausted ? 'quota-full' : ''}}" style="width: {{jobQuotaProgress}}%"></view>
              </view>
            </view>
          </block>
          <block wx:else>
            <text class="vip-desc">{{isMember ? 'æ‚¨å·²å¼€å¯å…¨éƒ¨ä¼šå‘˜ç‰¹æƒ' : 'è§£é” AI è‡ªåŠ¨ç¿»è¯‘ä¸å²—ä½è¦æ±‚æç‚¼'}}</text>
          </block>
        </view>

        <!-- åº•éƒ¨ï¼šæ“ä½œæŒ‰é’®ä¸å‡èˆ±å¼•å¯¼ -->
        <view class="vip-card-footer">
          <block wx:if="{{memberLevel === 1 && isQuotaExhausted}}">
            <view class="upgrade-guide-box" catchtap="onUpgrade">
              <text class="upgrade-text">é¢åº¦å·²æ»¡ï¼Ÿè¡¥å·®ä»· Â¥{{upgradeAmount}} å‡çº§æœˆå¡ â¯</text>
            </view>
          </block>
          <view wx:else></view> <!-- å ä½ä¿æŒ space-between -->
          <view class="vip-btn btn-level-{{memberLevel}}">{{isMember ? 'ç®¡ç†æƒç›Š' : 'ç«‹å³è§£é”'}}</view>
        </view>
      </view>

      <view class="vip-card-bg-icon">âœ¨</view>
      <view wx:if="{{memberLevel === 3}}" class="shimmer-effect"></view>
    </view>

    <!-- 3. æ ¸å¿ƒåŠŸèƒ½åˆ—è¡¨ Action List Group -->
    <view class="action-list-group">
      <view class="action-row" bindtap="onResumeProfileTap" hover-class="row-hover">
        <view class="row-left">
          <view class="icon-circle blue-bg">ğŸ“„</view>
          <view class="row-text">
            <text class="row-title">{{ui.resumeProfileEntry}}</text>
            <text class="row-subtitle">å®Œå–„ä¿¡æ¯ï¼Œæå‡ AI åŒ¹é…åº¦</text>
          </view>
        </view>
        <view class="row-right">
          <text class="row-arrow">â¯</text>
        </view>
      </view>

      <view class="action-row" bindtap="onGeneratedResumesTap" hover-class="row-hover">
        <view class="row-left">
          <view class="icon-circle green-bg">âœ¨</view>
          <view class="row-text">
            <text class="row-title">{{ui.generatedResumesEntry}}</text>
            <text class="row-subtitle">é¢„è§ˆåŠä¸‹è½½ PDF ç®€å†</text>
          </view>
        </view>
        <view class="row-right">
          <text class="row-arrow">â¯</text>
        </view>
      </view>

      <view class="action-row" bindtap="onAppliedJobsTap" hover-class="row-hover">
        <view class="row-left">
          <view class="icon-circle purple-bg">ğŸ“®</view>
          <view class="row-text">
            <text class="row-title">{{ui.appliedJobsEntry}}</text>
            <text class="row-subtitle">è¿½è¸ªç®€å†æŠ•é€’è¿›åº¦</text>
          </view>
        </view>
        <view class="row-right">
          <text class="row-arrow">â¯</text>
        </view>
      </view>
    </view>

    <!-- 4. è®¾ç½®åˆ—è¡¨ Settings List -->
    <view class="settings-group">
      <view class="setting-row" bindtap="onLanguageTap" hover-class="row-hover">
        <view class="row-left">
          <view class="row-icon-box"><text>ğŸŒ</text></view>
          <text class="row-label">{{ui.languageEntry}}</text>
        </view>
        <view class="row-right">
          <text class="row-value">{{appLanguage === 'Chinese' ? 'ä¸­æ–‡ (æ ‡å‡†)' : (appLanguage === 'AIChinese' ? 'AI æ™ºèƒ½å…¨ä¸­æ–‡' : (appLanguage === 'English' ? 'English' : 'AI Smart English'))}}</text>
          <text class="row-arrow">â¯</text>
        </view>
      </view>

      <view class="setting-row" bindtap="onInviteTap" hover-class="row-hover">
        <view class="row-left">
          <view class="row-icon-box"><text>ğŸ</text></view>
          <text class="row-label">{{ui.inviteCodeEntry}}</text>
        </view>
        <view class="row-right">
          <text class="row-arrow">â¯</text>
        </view>
      </view>
    </view>

    <!-- 5. é€€å‡ºç™»å½•/åˆ‡æ¢è´¦å· (æœªæ¥æ‰©å±•) -->
  </view>

  <!-- Bottom Sheets & Modals (Rest of the original code) -->
  <block wx:if="{{showLanguageSheet}}">
    <view class="bottom-sheet-mask {{languageSheetOpen ? 'bottom-sheet-mask-open' : ''}}"
          bindtap="closeLanguageSheet"></view>
    <view class="bottom-sheet {{languageSheetOpen ? 'bottom-sheet-open' : ''}}">
      <view class="bottom-sheet-content">
        <view class="sheet-title-row">
          <text class="sheet-title">{{ui.languageEntry}}</text>
        </view>

        <!-- Standard Modes -->
        <view class="mode-section-title">åŸºç¡€æ¨¡å¼</view>
        <view class="mode-card {{appLanguage === 'Chinese' ? 'mode-card-active' : ''}}"
              data-value="Chinese" bindtap="onLanguageSelect">
          <view class="mode-card-main">
            <text class="mode-name">{{ui.langChinese}}</text>
            <text class="mode-desc">{{ui.langChineseDesc}}</text>
          </view>
          <view class="mode-check" wx:if="{{appLanguage === 'Chinese'}}">
            <icon type="success_no_circle" size="16" color="#1d4ed8"/>
          </view>
        </view>

        <view class="mode-card {{appLanguage === 'English' ? 'mode-card-active' : ''}}"
              data-value="English" bindtap="onLanguageSelect">
          <view class="mode-card-main">
            <text class="mode-name">{{ui.langEnglish}}</text>
            <text class="mode-desc">{{ui.langEnglishDesc}}</text>
          </view>
          <view class="mode-check" wx:if="{{appLanguage === 'English'}}">
            <icon type="success_no_circle" size="16" color="#1d4ed8"/>
          </view>
        </view>

        <!-- AI VIP Modes -->
        <view class="mode-section-title mode-section-title-vip">
          <text>AI å¢å¼ºæ¨¡å¼</text>
          <text class="vip-tag-mini">VIP</text>
        </view>

        <view class="mode-card mode-card-vip {{appLanguage === 'AIChinese' ? 'mode-card-active' : ''}}"
              data-value="AIChinese" bindtap="onLanguageSelect">
          <view class="mode-card-icon">âœ¨</view>
          <view class="mode-card-main">
            <text class="mode-name">{{ui.langAIChinese}}</text>
            <text class="mode-desc">{{ui.langAIChineseDesc}}</text>
          </view>
          <view class="mode-check" wx:if="{{appLanguage === 'AIChinese'}}">
            <icon type="success_no_circle" size="16" color="#1d4ed8"/>
          </view>
        </view>

        <view class="mode-card mode-card-vip {{appLanguage === 'AIEnglish' ? 'mode-card-active' : ''}}"
              data-value="AIEnglish" bindtap="onLanguageSelect">
          <view class="mode-card-icon">âœ¨</view>
          <view class="mode-card-main">
            <text class="mode-name">{{ui.langAIEnglish}}</text>
            <text class="mode-desc">{{ui.langAIEnglishDesc}}</text>
          </view>
          <view class="mode-check" wx:if="{{appLanguage === 'AIEnglish'}}">
            <icon type="success_no_circle" size="16" color="#1d4ed8"/>
          </view>
        </view>
      </view>
    </view>
  </block>

  <block wx:if="{{showInviteSheet}}">
    <view class="bottom-sheet-mask {{inviteSheetOpen ? 'bottom-sheet-mask-open' : ''}}"
          bindtap="closeInviteSheet"></view>
    <view class="bottom-sheet {{inviteSheetOpen ? 'bottom-sheet-open' : ''}}">
      <view class="bottom-sheet-content invite-sheet-content">
        <view class="invite-section">
          <text class="invite-section-title">{{ui.myInviteCode}}</text>
          <view class="invite-code-display" bindtap="onCopyInviteCode">
            <text class="invite-code-text">{{myInviteCode}}</text>
            <text class="invite-code-copy">å¤åˆ¶</text>
          </view>
        </view>
        <view class="invite-section">
          <text class="invite-section-title">{{ui.inputInviteCode}}</text>
          <input class="invite-code-input" type="text" placeholder="è¯·è¾“å…¥é‚€è¯·ç " value="{{inputInviteCode}}" bindinput="onInviteCodeInput" />
          <button class="invite-apply-btn" bindtap="onApplyInviteCode">åº”ç”¨</button>
        </view>
      </view>
    </view>
  </block>

  <include src="./profile-sheet.wxml"/>

  <!-- ä¼šå‘˜æƒç›Šä¸­å¿ƒå¼¹çª— Member Hub Sheet -->
  <block wx:if="{{showMemberHub}}">
    <view class="bottom-sheet-mask {{memberHubOpen ? 'bottom-sheet-mask-open' : ''}}" bindtap="closeMemberHub"></view>
    <view class="bottom-sheet {{memberHubOpen ? 'bottom-sheet-open' : ''}}">
      <view class="bottom-sheet-content member-hub-content">
        
        <!-- 1. Header: Status & Expiry -->
        <view class="hub-header">
          <view class="hub-user-info">
            <view class="vip-badge-icon badge-level-{{memberLevel}}"></view>
            <text class="hub-level-name">{{memberBadgeText || 'æ™®é€šç”¨æˆ·'}}</text>
          </view>
          <text class="hub-expiry-date" wx:if="{{isMember}}">{{expiredDateText}}åˆ°æœŸ</text>
        </view>

        <!-- 2. Quota Dashboard -->
        <view class="hub-quota-card">
          <view class="quota-title-row">
            <text class="quota-title">AI å²—ä½æç‚¼é¢åº¦</text>
            <text class="quota-infinite-tag" wx:if="{{memberLevel === 3}}">UNLIMITED</text>
          </view>
          
          <block wx:if="{{memberLevel === 3}}">
            <view class="quota-infinite-box">
              <text class="quota-infinite-text">âˆ æ— é™åˆ¶ä½¿ç”¨</text>
              <view class="infinite-sparkle">âœ¨</view>
            </view>
          </block>
          <block wx:else>
            <view class="hub-progress-section">
              <view class="hub-progress-bar">
                <view class="hub-progress-inner {{isQuotaExhausted ? 'quota-full' : ''}}" style="width: {{jobQuotaProgress}}%"></view>
              </view>
              <view class="hub-quota-labels">
                <text class="hub-quota-used">å·²ç”¨ {{jobQuotaUsed}}</text>
                <text class="hub-quota-limit">æ€»é¢åº¦ {{jobQuotaLimit}}</text>
              </view>
            </view>
          </block>
        </view>

        <!-- 3. Privileges List -->
        <view class="hub-benefit-list">
          <view class="hub-benefit-item {{memberLevel >= 1 ? 'benefit-active' : ''}}">
            <icon type="{{memberLevel >= 1 ? 'success' : 'waiting'}}" size="16" color="{{memberLevel >= 1 ? '#2e5fe9' : '#cbd5e1'}}" />
            <view class="benefit-info">
              <text class="benefit-name">AI å²—ä½æ™ºèƒ½ç¿»è¯‘</text>
              <text class="benefit-sub">å…¨ä¸­/è‹±å²—ä½æè¿°ï¼Œæ— éšœç¢é˜…è¯»</text>
            </view>
          </view>
          <view class="hub-benefit-item {{memberLevel >= 2 ? 'benefit-active' : ''}}">
            <icon type="{{memberLevel >= 2 ? 'success' : 'waiting'}}" size="16" color="{{memberLevel >= 2 ? '#2e5fe9' : '#cbd5e1'}}" />
            <view class="benefit-info">
              <text class="benefit-name">AI ç”Ÿæˆç®€å†</text>
              <text class="benefit-sub">é’ˆå¯¹ä¸åŒå²—ä½ï¼Œæ™ºèƒ½ç”Ÿæˆé«˜åŒ¹é…åº¦ç®€å†</text>
            </view>
          </view>
          <view class="hub-benefit-item {{memberLevel >= 3 ? 'benefit-active' : ''}}">
            <icon type="{{memberLevel >= 3 ? 'success' : 'waiting'}}" size="16" color="{{memberLevel >= 3 ? '#2e5fe9' : '#cbd5e1'}}" />
            <view class="benefit-info">
              <text class="benefit-name">ä¸€é”®æŠ•é€’ç®€å†</text>
              <text class="benefit-sub">æé€Ÿç›´è¾¾æ‹›è˜æ–¹ï¼Œè§£å†³ç½‘ç»œæŠ•é€’éš¾é¢˜</text>
            </view>
          </view>
        </view>

        <!-- 4. Action Bar -->
        <view class="hub-action-bar">
          <view class="hub-action-left {{memberLevel === 3 ? 'full-width' : ''}}" bindtap="onRenew">
            <text class="action-btn-text secondary">ç«‹å³ç»­è´¹</text>
          </view>
          <view class="hub-action-right" wx:if="{{memberLevel < 3}}" bindtap="onUpgrade">
            <text class="action-btn-text primary">è¡¥å·®ä»· Â¥{{upgradeAmount}} å‡çº§</text>
          </view>
        </view>

      </view>
    </view>
  </block>
</view>
