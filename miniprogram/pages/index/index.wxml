<!-- Remote jobs list page -->
<view class="page">
  <view class="page-header">
    <!-- title removed -->
    <view class="filter-toggle" bindtap="toggleFilter">
      <text class="filter-label">{{currentFilter}}</text>
      <view class="filter-triangle {{showFilter ? 'filter-triangle-up' : ''}}" />
    </view>
  </view>

  <view class="search-bar">
    <input
      class="search-input"
      type="text"
      placeholder="搜索职位名称或来源.."
      placeholder-class="search-placeholder"
      confirm-type="search"
      value="{{searchKeyword}}"
      bindinput="onSearchInput"
    />

    <view class="search-actions">
      <view class="search-pill" bindtap="toggleFilter">
        <text class="search-pill-text">{{currentFilter}}</text>
        <view class="search-pill-triangle {{showFilter ? 'search-pill-triangle-up' : ''}}" />
      </view>

      <view class="search-pill" bindtap="toggleDrawer">
        <text class="search-pill-text">筛选</text>
        <view class="search-pill-triangle" />
      </view>
    </view>
  </view>

  <!-- Drawer Component -->
  <drawer
    show="{{showDrawer}}"
    value="{{drawerFilter}}"
    bind:close="toggleDrawer"
    bind:confirm="onDrawerConfirm"
    bind:reset="onDrawerReset"
    bind:openFavorites="openFavoritesSheet"
  />

  <!-- Collected jobs bottom sheet -->
  <block wx:if="{{showFavoritesSheet}}">
    <view class="favorites-sheet-mask {{favoritesSheetOpen ? 'favorites-sheet-mask-open' : ''}}" bindtap="closeFavoritesSheet"></view>
    <view class="favorites-sheet {{favoritesSheetOpen ? 'favorites-sheet-open' : ''}}">
      <view class="favorites-sheet-handle"></view>
      <scroll-view
        class="favorites-sheet-list"
        scroll-y="true"
        enhanced="true"
        show-scrollbar="{{false}}"
      >
        <view class="job-list-content">
          <block wx:if="{{favoritesLoading}}">
            <view class="list-loading">加载中...</view>
          </block>
          <block wx:elif="{{favoritesJobs.length === 0}}">
            <view class="empty-favorites">暂无收藏岗位</view>
          </block>
          <block wx:else>
            <block wx:for="{{favoritesJobs}}" wx:key="jobId">
              <view class="job-card" data-_id="{{item.jobId}}" data-collection="{{item.sourceCollection}}" bindtap="onFavoriteJobTap">
                <view class="job-main">
                  <view class="job-title-row">
                    <text class="job-title">{{item.title}}</text>
                    <text class="job-time">{{item.createdAt}}</text>
                  </view>
                  <view class="job-meta" wx:if="{{(item.team && item.team !== '未知公司') || item.salary}}">
                    <text wx:if="{{item.team && item.team !== '未知公司'}}" class="job-meta-item">{{item.team}}</text>
                    <text wx:if="{{(item.team && item.team !== '未知公司') && item.salary}}" class="job-meta-dot">·</text>
                    <text wx:if="{{item.salary}}" class="job-meta-item">{{item.salary}}</text>
                  </view>
                  <scroll-view
                  enhanced="true"
                  class="job-tags" scroll-x="true"     show-scrollbar="{{false}}">
                    <view class="job-tag" wx:for="{{item.displayTags || item.tags}}" wx:key="*this">
                      <text class="job-tag-text">{{item}}</text>
                    </view>
                  </scroll-view>
                </view>
              </view>
            </block>
          </block>
        </view>
      </scroll-view>
    </view>
  </block>

  <!-- Job Detail Drawer Component -->
  <job-detail
    show="{{showJobDetail}}"
    job-id="{{selectedJobId}}"
    collection="{{selectedCollection}}"
    bind:close="closeJobDetail"
  />

  <!-- 遮罩层：点击非弹窗区域时关闭弹窗 -->
  <view wx:if="{{showFilter}}" class="filter-mask" bindtap="toggleFilter"></view>

  <view wx:if="{{showFilter}}" class="filter-dropdown" catchtap="stopPropagation">
    <block wx:for="{{filterOptions}}" wx:key="*this">
      <view class="filter-option" data-value="{{item}}" bindtap="onSelectFilter">
        <text>{{item}}</text>
      </view>
    </block>
  </view>

  <scroll-view
    class="job-list"
    scroll-y="{{isScrollable}}"
    scroll-top="{{scrollTop}}"
    scroll-with-animation="{{true}}"
    lower-threshold="{{lowerThreshold}}"
    bindscrolltolower="onScrollLower"
    bindscroll="onScroll"
    bindtouchstart="onTouchStart"
    bindtouchend="onTouchEnd"
    enhanced="true"
    show-scrollbar="{{false}}"
    enable-back-to-top="{{false}}"
    enable-passive="{{true}}"
  >
    <view class="job-list-content">
      <block wx:for="{{filteredJobs}}" wx:key="_id">
        <view class="job-card" data-_id="{{item._id}}" bindtap="onJobTap">
          <view class="job-main">
            <view class="job-title-row">
              <text class="job-title">{{item.title}}</text>
              <text class="job-time">{{item.createdAt}}</text>
            </view>
            <view class="job-meta" wx:if="{{(item.team && item.team !== '未知公司') || item.salary}}">
              <text wx:if="{{item.team && item.team !== '未知公司'}}" class="job-meta-item">{{item.team}}</text>
              <text wx:if="{{(item.team && item.team !== '未知公司') && item.salary}}" class="job-meta-dot">·</text>
              <text wx:if="{{item.salary}}" class="job-meta-item">{{item.salary}}</text>
            </view>
            <scroll-view
            enhanced="true"
            class="job-tags"
            scroll-x="{{true}}"
            show-scrollbar="{{false}}">
              <view class="job-tag" wx:for="{{item.displayTags || item.tags}}" wx:key="*this">
                <text class="job-tag-text">{{item}}</text>
              </view>
            </scroll-view>
          </view>
        </view>
      </block>
      <view wx:if="{{loading}}" class="list-loading">加载中...</view>
      <view wx:if="{{!hasMore && filteredJobs.length > 0}}" class="no-more-container">
        <view class="no-more-text {{showNoMore ? 'no-more-visible' : ''}}">没有更多了</view>
      </view>
    </view>
  </scroll-view>

</view>
